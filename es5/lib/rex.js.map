{"version":3,"sources":["../../lib/rex.js"],"names":["verify","require","a","ert","_","TYPE_AND_LEN","exports","matchType","str","isString","match","exec","name","length","FUNC","matchFunction","resultType","isCallback","indexOf","trim","args","split","BEGIN_FIELDS","END_FIELDS","matchFields","keyword","regExp","RegExp","content","parts","ARRAY_DECL","matchArrayDeclaration","defBody","TYPE","stars"],"mappings":"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","file":"rex.js","sourcesContent":["/*\r\nCopyright 2016 Gábor Mező (gabor.mezo@outlook.com)\r\n\r\nLicensed under the Apache License, Version 2.0 (the \"License\");\r\nyou may not use this file except in compliance with the License.\r\nYou may obtain a copy of the License at\r\n\r\n    http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nUnless required by applicable law or agreed to in writing, software\r\ndistributed under the License is distributed on an \"AS IS\" BASIS,\r\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\nSee the License for the specific language governing permissions and\r\nlimitations under the License.\r\n*/\r\n\r\n'use strict';\r\nconst verify = require('./verify');\r\nconst a = verify.a;\r\nconst ert = verify.ert;\r\nconst _ = require('lodash');\r\n\r\nconst TYPE_AND_LEN = /^\\s*([\\w_][\\w\\d_]*)\\s*(?:\\[\\s*(\\d+)\\s*\\])?\\s*$/;\r\n\r\nexports.matchType = function (str) {\r\n    a&&ert(_.isString(str));\r\n\r\n    const match = TYPE_AND_LEN.exec(str);\r\n    if (!match) {\r\n        return null;\r\n    }\r\n    return {\r\n        name: match[1],\r\n        length: match[2] || null\r\n    };\r\n}\r\n\r\nconst FUNC = /^\\s*([\\w_][\\w\\d_]*\\s*\\**)\\s*((?:\\s*\\(\\s*\\*\\s*)?([\\w_][\\w\\d_]*)(?:\\s*\\)\\s*)?)\\s*\\((.*)\\)\\s*$/;\r\n\r\nexports.matchFunction = function (str) {\r\n    a&&ert(_.isString(str));\r\n\r\n    const match = FUNC.exec(str);\r\n    if (match && match.length === 5) {\r\n        const resultType = match[1];\r\n        const isCallback = match[2].indexOf('*') >= 0;\r\n        const name = match[3].trim();\r\n        let args = match[4].trim();\r\n        args = args ? args.split(',') : [];\r\n        return {\r\n            name,\r\n            isCallback,\r\n            args,\r\n            resultType\r\n        };\r\n    }\r\n    return null;    \r\n}\r\n\r\nconst BEGIN_FIELDS = '^\\\\s*';\r\nconst END_FIELDS = '\\\\s*([\\\\w_][\\\\w\\\\d_]*)\\\\s*{(.*)}\\s*$';\r\n\r\nexports.matchFields = function (keyword, str) {\r\n    a&&ert(_.isString(keyword));\r\n    a&&ert(_.isString(str));\r\n\r\n    const regExp = new RegExp(BEGIN_FIELDS + keyword + END_FIELDS);\r\n    const match = regExp.exec(str);\r\n    if (match && match.length === 3) {\r\n        const name = match[1];\r\n        const content = match[2];\r\n        const parts = content.split(';');\r\n        return { name, parts };\r\n    }\r\n    return null;\r\n}\r\n\r\nconst ARRAY_DECL = /^\\s*([\\w_][\\w\\d_]*)\\s*\\[\\s*\\]\\s*([\\w_][\\w\\d_]*)\\s*$/;\r\n\r\nexports.matchArrayDeclaration = function (str) {\r\n    a&&ert(_.isString(str));\r\n\r\n    const match = ARRAY_DECL.exec(str);\r\n    if (match && match.length === 3) {\r\n        return { \r\n            name: match[2], \r\n            defBody: match[1] \r\n        };\r\n    }\r\n    return null;\r\n}\r\n\r\nconst TYPE = /(([\\w_][\\w\\d_]*)\\s*(?:\\[\\s*(\\d+)\\s*\\])?)([\\s\\*]*)/;\r\n\r\nexports.matchType = function (str) {\r\n    a&&ert(_.isString(str));\r\n\r\n    const match = TYPE.exec(str);\r\n    if (match && match.length === 5) {\r\n        return {\r\n            name: match[2],\r\n            length: match[3],\r\n            stars: match[4]\r\n        };\r\n    }\r\n    return null;\r\n}"]}