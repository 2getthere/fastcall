{"version":3,"sources":["../../lib/queue.js"],"names":["_","require","assert","verify","Promise","top","resolve","length","Object","defineProperty","exports","get","next","f","isFunction","catch","noop","then","try","finally"],"mappings":"AAAA;;AACA,IAAMA,IAAIC,QAAQ,QAAR,CAAV;AACA,IAAMC,SAASD,QAAQ,QAAR,CAAf;AACA,IAAME,SAASF,QAAQ,UAAR,CAAf;AACA,IAAMG,UAAUH,QAAQ,UAAR,CAAhB;;AAEA,IAAII,MAAMD,QAAQE,OAAR,EAAV;AACA,IAAIC,SAAS,CAAb;;AAEAC,OAAOC,cAAP,CAAsBC,OAAtB,EAA+B,QAA/B,EAAyC,EAAEC,KAAK;AAAA,eAAMJ,MAAN;AAAA,KAAP,EAAzC;;AAEAG,QAAQE,IAAR,GAAe,UAAUC,CAAV,EAAa;AACxBV,WAAOH,EAAEc,UAAF,CAAaD,CAAb,CAAP;;AAEAN;AACAF,UAAMA,IACLU,KADK,CACCf,EAAEgB,IADH,EAELC,IAFK,CAEA,YAAM;AACR,eAAOb,QAAQc,GAAR,CAAYL,CAAZ,CAAP;AACH,KAJK,EAKLM,OALK,CAKG,YAAM;AACXZ;AACH,KAPK,CAAN;;AASA,WAAOF,GAAP;AACH,CAdD","file":"queue.js","sourcesContent":["'use strict';\nconst _ = require('lodash');\nconst assert = require('assert');\nconst verify = require('./verify');\nconst Promise = require('bluebird');\n\nlet top = Promise.resolve();\nlet length = 0;\n\nObject.defineProperty(exports, 'length', { get: () => length });\n\nexports.next = function (f) {\n    verify(_.isFunction(f));\n\n    length++;        \n    top = top\n    .catch(_.noop)\n    .then(() => {\n        return Promise.try(f);\n    })\n    .finally(() => {\n        length--;\n    });\n\n    return top;\n}"]}