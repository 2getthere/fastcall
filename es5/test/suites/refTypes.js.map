{"version":3,"sources":["../../../test/suites/refTypes.js"],"names":["fastcall","require","Library","helpers","assert","_","ref","Promise","async","coroutine","StructType","UnionType","ArrayType","describe","libPath","lib","before","findTestlib","beforeEach","afterEach","release","it","result","struct","TNumbers","a","b","c","types","long","equal","testStructInterface","function","testMulStructMembersSync","mulStructMembers","refType","asyncFunction","testMulStructMembersAsync","isObject","structs","isFunction","interface","type","ptr1","Buffer","numbers","noname","strictEqual","derefType","functions","args","ptr","union","TUnion","testUnionInterface","testAccessUnionMembersSync","getAFromUnion","getBFromUnion","getCFromUnion","testAccessUnionMembersAsync","unions","IntArray","arr","throws","array","TLongArray","TRecWithArray","values","index","testArrayInterface","testArrayFuncsSync","TRecWithArrays","makeRecWithArrays","incRecWithArrays","freeRecWithArrays","testArrayFuncsAsync","fixed","arrays","length","record","get","resultRef","alloc","sizeRef","size","deref","i","rec","j","records","TTaggedUnion","getValueFromTaggedUnion","tag","charCodeAt","data"],"mappings":"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","file":"refTypes.js","sourcesContent":["/*\r\nCopyright 2016 Gábor Mező (gabor.mezo@outlook.com)\r\n\r\nLicensed under the Apache License, Version 2.0 (the \"License\");\r\nyou may not use this file except in compliance with the License.\r\nYou may obtain a copy of the License at\r\n\r\n    http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nUnless required by applicable law or agreed to in writing, software\r\ndistributed under the License is distributed on an \"AS IS\" BASIS,\r\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\nSee the License for the specific language governing permissions and\r\nlimitations under the License.\r\n*/\r\n\r\n'use strict';\r\nconst fastcall = require('../../lib');\r\nconst Library = fastcall.Library;\r\nconst helpers = require('./helpers');\r\nconst assert = require('assert');\r\nconst _ = require('lodash');\r\nconst ref = fastcall.ref;\r\nconst Promise = require('bluebird');\r\nconst async = Promise.coroutine;\r\nconst StructType = fastcall.StructType;\r\nconst UnionType = fastcall.UnionType;\r\nconst ArrayType = fastcall.ArrayType;\r\n\r\ndescribe(`ref types`, function () {\r\n    let libPath = null;\r\n    let lib = null;\r\n    before(async(function* () {\r\n        libPath = yield helpers.findTestlib();\r\n    }));\r\n\r\n    beforeEach(function () {\r\n        lib = new Library(libPath);\r\n    });\r\n\r\n    afterEach(function () {\r\n        lib.release();\r\n    });\r\n\r\n    describe('Struct', function () {\r\n        it('could be created by plain object definition', function () {\r\n            const result = lib.struct({\r\n                TNumbers: {\r\n                    a: 'short',\r\n                    b: 'int64',\r\n                    c: ref.types.long\r\n                }\r\n            });\r\n\r\n            assert.equal(result, lib);\r\n            testStructInterface();\r\n        });\r\n\r\n        it('could be created from StructType', function () {\r\n            const TNumbers = new StructType({\r\n                a: 'short',\r\n                b: 'int64',\r\n                c: ref.types.long\r\n            });\r\n            const result = lib.struct({ TNumbers });\r\n\r\n            assert.equal(result, lib);\r\n            testStructInterface();\r\n        });\r\n\r\n        it('should supports C struct like syntax', function () {\r\n            const result = lib.struct('struct TNumbers { short a; int64 b; long c; }');\r\n\r\n            assert.equal(result, lib);\r\n            testStructInterface();\r\n        });\r\n\r\n        describe('sync', function () {\r\n           it('should get referenced by string syntax', function () {\r\n                lib.struct({\r\n                    TNumbers: {\r\n                        a: 'short',\r\n                        b: 'int64',\r\n                        c: ref.types.long\r\n                    }\r\n                })\r\n                .function('int64 mulStructMembers(TNumbers* numbers)');\r\n\r\n                testMulStructMembersSync();\r\n            });\r\n\r\n            it('should get referenced by node-ffi-like syntax', function () {\r\n                const TNumbers = new StructType({\r\n                    a: 'short',\r\n                    b: 'int64',\r\n                    c: ref.types.long\r\n                });\r\n                lib.function({ mulStructMembers: ['int64', [ ref.refType(TNumbers) ]] });\r\n\r\n                testMulStructMembersSync(true);\r\n            });\r\n        });\r\n\r\n        describe('async', function () {\r\n           it('should get referenced by string syntax', async(function* () {\r\n                lib.struct({\r\n                    TNumbers: {\r\n                        a: 'short',\r\n                        b: 'int64',\r\n                        c: ref.types.long\r\n                    }\r\n                })\r\n                .asyncFunction('int64 mulStructMembers(TNumbers* numbers)');\r\n\r\n                yield testMulStructMembersAsync();\r\n            }));\r\n\r\n            it('should get referenced by node-ffi-like syntax', async(function* () {\r\n                const TNumbers = new StructType({\r\n                    a: 'short',\r\n                    b: 'int64',\r\n                    c: ref.types.long\r\n                });\r\n                lib.asyncFunction({ mulStructMembers: ['int64', [ ref.refType(TNumbers) ]] });\r\n\r\n                yield testMulStructMembersAsync(true);\r\n            }));\r\n        });\r\n\r\n        function testStructInterface() {\r\n            assert(_.isObject(lib.structs.TNumbers));\r\n            assert(_.isFunction(lib.interface.TNumbers));\r\n            assert(_.isFunction(lib.structs.TNumbers.type));\r\n            assert.equal(lib.interface.TNumbers.struct, lib.structs.TNumbers);\r\n            assert.equal(lib.interface.TNumbers.type, lib.structs.TNumbers.type);\r\n\r\n            const ptr1 = lib.interface.TNumbers({\r\n                a: 1,\r\n                b: 2,\r\n                c: 3\r\n            });\r\n            assert(ptr1 instanceof Buffer);\r\n            assert.equal(ptr1.type, lib.structs.TNumbers.type);\r\n            assert.equal(ptr1.struct, lib.structs.TNumbers);\r\n\r\n            const numbers = lib.structs.TNumbers.type(ptr1);\r\n            assert.equal(numbers.a, 1);\r\n            assert.equal(numbers.b, 2);\r\n            assert.equal(numbers.c, 3);\r\n        }\r\n\r\n        function testMulStructMembersSync(noname) {\r\n            assert(_.isFunction(lib.interface.mulStructMembers));\r\n\r\n            let result;\r\n            if (!noname) {\r\n                assert(_.isFunction(lib.interface.TNumbers));\r\n                assert.strictEqual(ref.derefType(lib.functions.mulStructMembers.args[0].type), lib.structs.TNumbers.type);\r\n                const ptr = lib.interface.TNumbers({\r\n                    a: 1,\r\n                    b: 2,\r\n                    c: 3\r\n                });\r\n                result = lib.interface.mulStructMembers(ptr);\r\n            }\r\n            else {\r\n                const TNumbers = new StructType({\r\n                    a: 'short',\r\n                    b: 'int64',\r\n                    c: ref.types.long\r\n                });\r\n\r\n                const numbers = new TNumbers();\r\n                numbers.a = 1;\r\n                numbers.b = 2;\r\n                numbers.c = 3;\r\n\r\n                result = lib.interface.mulStructMembers(numbers.ref());\r\n            }\r\n\r\n            assert.equal(result, 1 * 2 * 3);\r\n        }\r\n\r\n        var testMulStructMembersAsync = async(function* (noname) {\r\n            assert(_.isFunction(lib.interface.mulStructMembers));\r\n\r\n            let result;\r\n            if (!noname) {\r\n                assert(_.isFunction(lib.interface.TNumbers));\r\n                assert.strictEqual(ref.derefType(lib.functions.mulStructMembers.args[0].type), lib.structs.TNumbers.type);\r\n                const ptr = lib.interface.TNumbers({\r\n                    a: 1,\r\n                    b: 2,\r\n                    c: 3\r\n                });\r\n                result = yield lib.interface.mulStructMembers(ptr);\r\n            }\r\n            else {\r\n                result = yield lib.interface.mulStructMembers({\r\n                    a: 1,\r\n                    b: 2,\r\n                    c: 3\r\n                });\r\n            }\r\n\r\n            assert.equal(result, 1 * 2 * 3);\r\n        });\r\n    });\r\n\r\n    describe('Union', function () {\r\n        it('could be created by plain object definition', function () {\r\n            const result = lib.union({\r\n                TUnion: {\r\n                    a: 'short',\r\n                    b: 'int64',\r\n                    c: ref.types.long\r\n                }\r\n            });\r\n\r\n            assert.equal(result, lib);\r\n            testUnionInterface();\r\n        });\r\n\r\n        it('could be created from UnionType', function () {\r\n            const TUnion = new UnionType({\r\n                a: 'short',\r\n                b: 'int64',\r\n                c: ref.types.long\r\n            });\r\n            const result = lib.union({ TUnion });\r\n\r\n            assert.equal(result, lib);\r\n            testUnionInterface();\r\n        });\r\n\r\n        it('should supports C union like syntax', function () {\r\n            const result = lib.union('union TUnion { short a; int64 b; long c; }');\r\n\r\n            assert.equal(result, lib);\r\n            testUnionInterface();\r\n        });\r\n\r\n        describe('sync', function () {\r\n           it('should get referenced by string syntax', function () {\r\n                lib.union({\r\n                    TUnion: {\r\n                        a: 'short',\r\n                        b: 'int64',\r\n                        c: ref.types.long\r\n                    }\r\n                })\r\n                .function('int64 getAFromUnion(TUnion* union)')\r\n                .function('int64 getBFromUnion(TUnion* union)')\r\n                .function('int64 getCFromUnion(TUnion* union)');\r\n\r\n                testAccessUnionMembersSync();\r\n            });\r\n\r\n            it('should get referenced by node-ffi-like syntax', function () {\r\n                const TUnion = new UnionType({\r\n                    a: 'short',\r\n                    b: 'int64',\r\n                    c: ref.types.long\r\n                });\r\n                lib.function({ getAFromUnion: ['int64', [ ref.refType(TUnion) ]] })\r\n                .function({ getBFromUnion: ['int64', [ ref.refType(TUnion) ]] })\r\n                .function({ getCFromUnion: ['int64', [ ref.refType(TUnion) ]] });\r\n\r\n                testAccessUnionMembersSync(true);\r\n            });\r\n        });\r\n\r\n        describe('async', function () {\r\n           it('should get referenced by string syntax', async(function* () {\r\n                lib.union({\r\n                    TUnion: {\r\n                        a: 'short',\r\n                        b: 'int64',\r\n                        c: ref.types.long\r\n                    }\r\n                })\r\n                .asyncFunction('int64 getAFromUnion(TUnion* union)')\r\n                .asyncFunction('int64 getBFromUnion(TUnion* union)')\r\n                .asyncFunction('int64 getCFromUnion(TUnion* union)');\r\n\r\n                yield testAccessUnionMembersAsync();\r\n            }));\r\n\r\n            it('should get referenced by node-ffi-like syntax', async(function* () {\r\n                const TUnion = new UnionType({\r\n                    a: 'short',\r\n                    b: 'int64',\r\n                    c: ref.types.long\r\n                });\r\n                lib.asyncFunction({ getAFromUnion: ['int64', [ ref.refType(TUnion) ]] })\r\n                .asyncFunction({ getBFromUnion: ['int64', [ ref.refType(TUnion) ]] })\r\n                .asyncFunction({ getCFromUnion: ['int64', [ ref.refType(TUnion) ]] });\r\n\r\n                yield testAccessUnionMembersAsync(true);\r\n            }));\r\n        });\r\n\r\n        function testUnionInterface() {\r\n            assert(_.isObject(lib.unions.TUnion));\r\n            assert(_.isFunction(lib.interface.TUnion));\r\n            assert(_.isFunction(lib.unions.TUnion.type));\r\n            assert.equal(lib.interface.TUnion.union, lib.unions.TUnion);\r\n            assert.equal(lib.interface.TUnion.type, lib.unions.TUnion.type);\r\n\r\n            const ptr1 = lib.interface.TUnion({\r\n                a: 1\r\n            });\r\n            assert(ptr1 instanceof Buffer);\r\n            assert.equal(ptr1.type, lib.unions.TUnion.type);\r\n            assert.equal(ptr1.union, lib.unions.TUnion);\r\n\r\n            const union = lib.unions.TUnion.type(ptr1);\r\n            assert.equal(union.a, 1);\r\n        }\r\n\r\n        function testAccessUnionMembersSync(noname) {\r\n            assert(_.isFunction(lib.interface.getAFromUnion));\r\n            assert(_.isFunction(lib.interface.getBFromUnion));\r\n            assert(_.isFunction(lib.interface.getCFromUnion));\r\n\r\n            if (!noname) {\r\n                assert(_.isFunction(lib.interface.TUnion));\r\n                assert.strictEqual(ref.derefType(lib.functions.getAFromUnion.args[0].type), lib.unions.TUnion.type);\r\n                assert.strictEqual(ref.derefType(lib.functions.getBFromUnion.args[0].type), lib.unions.TUnion.type);\r\n                assert.strictEqual(ref.derefType(lib.functions.getCFromUnion.args[0].type), lib.unions.TUnion.type);\r\n\r\n                const ptr = lib.interface.TUnion({ a: 1 });\r\n                let result = lib.interface.getAFromUnion(ptr);\r\n                assert.equal(result, 1);\r\n\r\n                const union = lib.unions.TUnion.type({ b: 2 });\r\n                result = lib.interface.getBFromUnion(union.ref());\r\n                assert.equal(result, 2);\r\n            }\r\n            else {\r\n                const result = lib.interface.getCFromUnion({ c: 3 });\r\n                assert.equal(result, 3);\r\n            }\r\n        }\r\n\r\n        var testAccessUnionMembersAsync = async(function* (noname) {\r\n            assert(_.isFunction(lib.interface.getAFromUnion));\r\n            assert(_.isFunction(lib.interface.getBFromUnion));\r\n            assert(_.isFunction(lib.interface.getCFromUnion));\r\n\r\n            if (!noname) {\r\n                assert(_.isFunction(lib.interface.TUnion));\r\n                assert.strictEqual(ref.derefType(lib.functions.getAFromUnion.args[0].type), lib.unions.TUnion.type);\r\n                assert.strictEqual(ref.derefType(lib.functions.getBFromUnion.args[0].type), lib.unions.TUnion.type);\r\n                assert.strictEqual(ref.derefType(lib.functions.getCFromUnion.args[0].type), lib.unions.TUnion.type);\r\n\r\n                const ptr = lib.interface.TUnion({ a: 1 });\r\n                let result = yield lib.interface.getAFromUnion(ptr);\r\n                assert.equal(result, 1);\r\n\r\n                const union = lib.unions.TUnion.type({ b: 2 });\r\n                result = yield lib.interface.getBFromUnion(union.ref());\r\n                assert.equal(result, 2);\r\n            }\r\n            else {\r\n                const result = yield lib.interface.getCFromUnion({ c: 3 });\r\n                assert.equal(result, 3);\r\n            }\r\n        });\r\n    });\r\n\r\n    describe('Array', function () {\r\n        it('should throw for not supported indexing', function () {\r\n            const IntArray = new ArrayType('int');\r\n            const arr = new IntArray([1, 2, 3]);\r\n            assert.throws(() => arr[0]);\r\n            assert.throws(() => arr[1]);\r\n            assert.throws(() => arr[2]);\r\n            assert.throws(() => arr[3]);\r\n            assert.throws(() => arr[4]);\r\n            assert.throws(() => arr[0] = 0);\r\n            assert.throws(() => arr[1] = 0);\r\n            assert.throws(() => arr[2] = 0);\r\n            assert.throws(() => arr[3] = 0);\r\n            assert.throws(() => arr[4] = 0);\r\n        });\r\n\r\n        describe('fixed length', function () {\r\n            it('could be created by plain object definition', function () {\r\n                const result = lib\r\n                .array({ TLongArray: 'long' })\r\n                .struct({\r\n                    TRecWithArray: {\r\n                        values: 'TLongArray[5]',\r\n                        index: 'uint'\r\n                    }\r\n                });\r\n\r\n                assert.equal(result, lib);\r\n                testArrayInterface(true);\r\n            });\r\n\r\n            it('could be created from ArrayType', function () {\r\n                const TLongArray = new ArrayType(ref.types.long);\r\n                const TRecWithArray = new StructType({\r\n                    values: new ArrayType(ref.types.long, 5),\r\n                    index: 'uint',\r\n                });\r\n                const result = lib.array({ TLongArray }).struct({ TRecWithArray });\r\n\r\n                assert.equal(result, lib);\r\n                testArrayInterface(true);\r\n            });\r\n\r\n            it('should supports C union like syntax', function () {\r\n                const result = lib\r\n                .array('long[] TLongArray')\r\n                .struct('struct TRecWithArray { TLongArray[5] values; uint index; }');\r\n\r\n                assert.equal(result, lib);\r\n                testArrayInterface(true);\r\n            });\r\n        });\r\n\r\n        describe('free length', function () {\r\n            describe('with square brackets', function () {\r\n                it('could be created by plain object definition', function () {\r\n                    const result = lib\r\n                    .array({ TLongArray: 'long' })\r\n                    .struct({\r\n                        TRecWithArray: {\r\n                            values: 'TLongArray[]',\r\n                            index: 'uint'\r\n                        }\r\n                    });\r\n\r\n                    assert.equal(result, lib);\r\n                    testArrayInterface();\r\n                });\r\n\r\n                it('should supports C union like syntax', function () {\r\n                    const result = lib\r\n                    .array('long[] TLongArray')\r\n                    .struct('struct TRecWithArray { TLongArray[] values; uint index; }');\r\n\r\n                    assert.equal(result, lib);\r\n                    testArrayInterface();\r\n                });\r\n            });\r\n\r\n            describe('without square brackets', function () {\r\n                it('could be created by plain object definition', function () {\r\n                    const result = lib\r\n                    .array({ TLongArray: 'long' })\r\n                    .struct({\r\n                        TRecWithArray: {\r\n                            values: 'TLongArray',\r\n                            index: 'uint'\r\n                        }\r\n                    });\r\n\r\n                    assert.equal(result, lib);\r\n                    testArrayInterface();\r\n                });\r\n\r\n                it('could be created from ArrayType', function () {\r\n                    const TLongArray = new ArrayType(ref.types.long);\r\n                    const TRecWithArray = new StructType({\r\n                        values: TLongArray,\r\n                        index: 'uint',\r\n                    });\r\n                    const result = lib.array({ TLongArray }).struct({ TRecWithArray });\r\n\r\n                    assert.equal(result, lib);\r\n                    testArrayInterface();\r\n                });\r\n\r\n                it('should supports C union like syntax', function () {\r\n                    const result = lib\r\n                    .array('long[] TLongArray')\r\n                    .struct('struct TRecWithArray { TLongArray values; uint index; }');\r\n\r\n                    assert.equal(result, lib);\r\n                    testArrayInterface();\r\n                });\r\n            });\r\n        });\r\n\r\n        describe('sync', function () {\r\n           it('should get referenced by string syntax', function () {\r\n                lib\r\n                .array('long[] TLongArray')\r\n                .struct('struct TRecWithArray { TLongArray[5] values; uint index; }')\r\n                .array('TRecWithArray[] TRecWithArrays')\r\n                .function('void makeRecWithArrays(TRecWithArrays* records, long* size)')\r\n                .function('void incRecWithArrays(TRecWithArray* records, long size)')\r\n                .function('void freeRecWithArrays(TRecWithArrays records)');\r\n\r\n                testArrayFuncsSync();\r\n            });\r\n\r\n            it('should get referenced by node-ffi-like syntax', function () {\r\n                const TRecWithArray = new StructType({\r\n                    values: new ArrayType(ref.types.long, 5),\r\n                    index: 'uint',\r\n                });\r\n                const TRecWithArrays = new ArrayType(TRecWithArray);\r\n                \r\n                lib\r\n                .function({ makeRecWithArrays: [ 'void', [ ref.refType(TRecWithArrays), ref.refType('long') ]] })\r\n                .function({ incRecWithArrays: [ 'void', [ TRecWithArrays, 'long' ]] })\r\n                .function({ freeRecWithArrays: [ 'void', [ TRecWithArrays ]] });\r\n\r\n                testArrayFuncsSync(TRecWithArray, TRecWithArrays);\r\n            });\r\n        });\r\n\r\n        describe('async', function () {\r\n           it('should get referenced by string syntax', async(function* () {\r\n                lib\r\n                .array('long[] TLongArray')\r\n                .struct('struct TRecWithArray { TLongArray[5] values; uint index; }')\r\n                .array('TRecWithArray[] TRecWithArrays')\r\n                .function('void makeRecWithArrays(TRecWithArrays* records, long* size)')\r\n                .function('void incRecWithArrays(TRecWithArrays records, long size)')\r\n                .function('void freeRecWithArrays(TRecWithArray* records)');\r\n\r\n                yield testArrayFuncsAsync();\r\n            }));\r\n\r\n            it('should get referenced by node-ffi-like syntax', async(function* () {\r\n                const TRecWithArray = new StructType({\r\n                    values: new ArrayType(ref.types.long, 5),\r\n                    index: 'uint',\r\n                });\r\n                const TRecWithArrays = new ArrayType(TRecWithArray);\r\n                \r\n                lib\r\n                .function({ makeRecWithArrays: [ 'void', [ ref.refType(TRecWithArrays), ref.refType('long') ]] })\r\n                .function({ incRecWithArrays: [ 'void', [ TRecWithArrays, 'long' ]] })\r\n                .function({ freeRecWithArrays: [ 'void', [ ref.refType(TRecWithArray) ]] });\r\n\r\n                yield testArrayFuncsAsync(TRecWithArray, TRecWithArrays);\r\n            }));\r\n        });\r\n\r\n        function testArrayInterface(fixed) {\r\n            assert(_.isObject(lib.structs.TRecWithArray));\r\n            assert(_.isFunction(lib.interface.TRecWithArray));\r\n            assert(_.isFunction(lib.structs.TRecWithArray.type));\r\n            assert.equal(lib.interface.TRecWithArray.struct, lib.structs.TRecWithArray);\r\n            assert.equal(lib.interface.TRecWithArray.type, lib.structs.TRecWithArray.type);\r\n\r\n            assert(_.isObject(lib.arrays.TLongArray));\r\n            assert(_.isFunction(lib.interface.TLongArray));\r\n            assert(_.isFunction(lib.arrays.TLongArray.type));\r\n            assert.equal(lib.interface.TLongArray.array, lib.arrays.TLongArray);\r\n            assert.equal(lib.interface.TLongArray.type, lib.arrays.TLongArray.type);\r\n\r\n            const ptr1 = lib.interface.TRecWithArray({\r\n                values: [0, 1, 2, 3, 4],\r\n                index: 42\r\n            });\r\n            if (fixed) {\r\n                assert(ptr1.length >= 24);\r\n            }\r\n            else {\r\n                assert(ptr1.length >= 16);\r\n            }\r\n            assert(ptr1 instanceof Buffer);\r\n            assert.equal(ptr1.type, lib.structs.TRecWithArray.type);\r\n            assert.equal(ptr1.struct, lib.structs.TRecWithArray);\r\n\r\n            const record = lib.structs.TRecWithArray.type(ptr1);\r\n            assert.equal(record.index, 42);\r\n            if (!fixed) {\r\n                assert.equal(record.values.length, 0);\r\n                record.values.length = 5;\r\n            }\r\n            assert.equal(record.values.length, 5);\r\n            assert.equal(record.values.get(0), 0);\r\n            assert.equal(record.values.get(1), 1);\r\n            assert.equal(record.values.get(2), 2);\r\n            assert.equal(record.values.get(3), 3);\r\n            assert.equal(record.values.get(4), 4);\r\n        }\r\n\r\n        function testArrayFuncsSync(TRecWithArray, TRecWithArrays) {\r\n            TRecWithArray = TRecWithArray || lib.structs.TRecWithArray.type;\r\n            assert(_.isFunction(TRecWithArray));\r\n            TRecWithArrays = TRecWithArrays || lib.arrays.TRecWithArrays.type;\r\n            assert(_.isFunction(TRecWithArrays));\r\n            assert(_.isFunction(lib.interface.makeRecWithArrays))\r\n            assert(_.isFunction(lib.interface.incRecWithArrays));\r\n            assert(_.isFunction(lib.interface.freeRecWithArrays));\r\n            \r\n            const resultRef = ref.alloc(TRecWithArrays);\r\n            const sizeRef = ref.alloc('long');\r\n            \r\n            lib.interface.makeRecWithArrays(resultRef, sizeRef);\r\n            const size = sizeRef.deref();\r\n            assert.equal(size, 5);\r\n            const result = resultRef.deref();\r\n            assert.equal(result.length, 0);\r\n            result.length = 5;\r\n            assert.equal(result.length, 5);\r\n            for (let i = 0; i < size; i++) {\r\n                const rec = result.get(i);\r\n                assert.equal(rec.index, i);\r\n                for (let j = 0; j < 5; j++) {\r\n                    assert.equal(rec.values.get(j), j);\r\n                }\r\n            }\r\n\r\n            lib.interface.freeRecWithArrays(result);\r\n        }\r\n\r\n        var testArrayFuncsAsync = async(function* (TRecWithArray, TRecWithArrays) {\r\n            TRecWithArray = TRecWithArray || lib.structs.TRecWithArray.type;\r\n            assert(_.isFunction(TRecWithArray));\r\n            TRecWithArrays = TRecWithArrays || lib.arrays.TRecWithArrays.type;\r\n            assert(_.isFunction(TRecWithArrays));\r\n            assert(_.isFunction(lib.interface.makeRecWithArrays))\r\n            assert(_.isFunction(lib.interface.incRecWithArrays));\r\n            assert(_.isFunction(lib.interface.freeRecWithArrays));\r\n\r\n            const records = new TRecWithArrays([\r\n                {\r\n                    index: 4,\r\n                    values: [3, 4, 5, 6, 7]\r\n                },\r\n                new TRecWithArray({\r\n                    index: 5,\r\n                    values: [-3, -4, -5, -6, -7]\r\n                })\r\n            ]);\r\n\r\n            yield lib.interface.incRecWithArrays.async(records, 2);\r\n\r\n            assert.equal(records.get(0).index, 5);\r\n            assert.equal(records.get(1).index, 6);\r\n\r\n            for (let i = 0; i < 5; i++) {\r\n                assert.equal(records.get(0).values.get(i), i + 4);\r\n                assert.equal(records.get(1).values.get(i), -2 - i);\r\n            }\r\n        });\r\n    });\r\n\r\n    describe('complex ref-types', function () {\r\n        describe('tagged union', function () {\r\n            beforeEach(function () {\r\n                lib.union('union TUnion { short a; int64 b; long c; }')\r\n                .struct('struct TTaggedUnion { char tag; TUnion data; }')\r\n                .function('int64 getValueFromTaggedUnion(TTaggedUnion* u)');\r\n\r\n                assert(_.isFunction(lib.interface.TUnion));\r\n                assert(_.isFunction(lib.interface.TTaggedUnion));\r\n                assert(_.isFunction(lib.interface.getValueFromTaggedUnion));\r\n                assert(lib.unions.TUnion);\r\n                assert(lib.structs.TTaggedUnion);\r\n                assert(lib.functions.getValueFromTaggedUnion);\r\n            });\r\n\r\n            it('works synchronously', function () {\r\n                let struct = lib.structs.TTaggedUnion.type({\r\n                    tag: 'b'.charCodeAt(0),\r\n                    data: { b: 42 }\r\n                });\r\n\r\n                assert(_.isObject(struct));\r\n                assert.equal(struct.tag, 'b'.charCodeAt(0));\r\n                assert.equal(struct.data.b, 42);\r\n\r\n                let result = lib.interface.getValueFromTaggedUnion(struct.ref());\r\n                assert.equal(result, 42);\r\n\r\n                struct = lib.structs.TTaggedUnion.type({\r\n                    tag: 'b'.charCodeAt(0),\r\n                    data: lib.interface.TUnion.type({ b: 42 })\r\n                });\r\n\r\n                assert(_.isObject(struct));\r\n                assert.equal(struct.tag, 'b'.charCodeAt(0));\r\n                assert.equal(struct.data.b, 42);\r\n\r\n                result = lib.interface.getValueFromTaggedUnion(struct.ref());\r\n                assert.equal(result, 42);\r\n            });\r\n\r\n            it('works asynchronously', async(function* () {\r\n                const result = yield lib.interface.getValueFromTaggedUnion.async({\r\n                    tag: 'a'.charCodeAt(0),\r\n                    data: { a: 5 }\r\n                });\r\n                assert.equal(result, 5);\r\n            }));\r\n        });\r\n    });\r\n});"]}